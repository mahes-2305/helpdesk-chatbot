<!DOCTYPE html>
<html>
<head>
<title>CipherBot AI</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    background: linear-gradient(135deg,#141e30,#243b55);
    height: 100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: Arial;
}
.chat-container {
    width: 500px;
    height: 600px;
    background: #1f2937;
    border-radius: 15px;
    display:flex;
    flex-direction:column;
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
}
.chat-header {
    padding:15px;
    background:#111827;
    color:white;
    text-align:center;
}
.chat-body {
    flex:1;
    padding:15px;
    overflow-y:auto;
}
.message {
    margin-bottom:15px;
    padding:10px 15px;
    border-radius:20px;
    max-width:75%;
}
.user {
    background:#3b82f6;
    color:white;
    margin-left:auto;
}
.bot {
    background:#374151;
    color:white;
}
.chat-footer {
    padding:10px;
    display:flex;
    background:#111827;
}
.chat-footer input {
    flex:1;
    border-radius:20px;
    border:none;
    padding:10px;
}
.chat-footer button {
    margin-left:10px;
    border-radius:20px;
}
.typing {
    font-size:12px;
    color:#9ca3af;
}
.feedback-btn {
    margin-right:5px;
}
</style>
</head>

<body>

<div class="chat-container">

<div class="chat-header d-flex justify-content-between align-items-center">
<div>
ü§ñ <strong>CipherBot AI</strong><br>
<small>College Helpdesk Assistant</small>
</div>
<a href="/login" class="btn btn-outline-light btn-sm">Admin</a>
</div>

<div id="chatBody" class="chat-body"></div>

<div class="chat-footer">
<input id="msg" placeholder="Ask me anything...">
<button class="btn btn-primary" onclick="send()">Send</button>
</div>

</div>

<script>
function send(){
    let msg = document.getElementById("msg").value;
    if(!msg) return;

    let chatBody = document.getElementById("chatBody");

    chatBody.innerHTML += `<div class="message user">${msg}</div>`;
    chatBody.innerHTML += `<div class="typing">CipherBot is typing...</div>`;
    chatBody.scrollTop = chatBody.scrollHeight;

    fetch("/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:msg})
    })
    .then(res=>res.json())
    .then(data=>{
        document.querySelector(".typing").remove();

        chatBody.innerHTML += `
            <div class="message bot">
                ${data.response}
                <br><small>Confidence: ${data.confidence}%</small>
                <div id="feedback-${data.log_id}" class="mt-2">
                    <button class="btn btn-sm btn-success feedback-btn"
                        onclick="sendFeedback(${data.log_id}, 'helpful')">üëç</button>
                    <button class="btn btn-sm btn-danger feedback-btn"
                        onclick="sendFeedback(${data.log_id}, 'not_helpful')">üëé</button>
                </div>
            </div>`;

        chatBody.scrollTop = chatBody.scrollHeight;
    });

    document.getElementById("msg").value="";
}

function sendFeedback(logId, type){
    fetch("/feedback",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            log_id: logId,
            type: type
        })
    });

    // Remove buttons after click
    document.getElementById(`feedback-${logId}`).innerHTML =
        "<small>Thanks for your feedback üëç</small>";
}
</script>

</body>
</html>